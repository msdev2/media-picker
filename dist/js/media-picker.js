/*! For license information please see media-picker.js.LICENSE.txt */
(()=>{"use strict";var e,t={601:()=>{function e(){var n,i,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function l(e,r,o,a){var l=r&&r.prototype instanceof s?r:s,u=Object.create(l.prototype);return t(u,"_invoke",function(e,t,r){var o,a,l,s=0,u=r||[],d=!1,h={p:0,n:0,v:n,a:m,f:m.bind(n,4),d:function(e,t){return o=e,a=0,l=n,h.n=t,c}};function m(e,t){for(a=e,l=t,i=0;!d&&s&&!r&&i<u.length;i++){var r,o=u[i],m=h.p,f=o[2];e>3?(r=f===t)&&(l=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=n):o[0]<=m&&((r=e<2&&m<o[1])?(a=0,h.v=t,h.n=o[1]):m<f&&(r=e<3||o[0]>t||t>f)&&(o[4]=e,o[5]=t,h.n=f,a=0))}if(r||e>1)return c;throw d=!0,t}return function(r,u,f){if(s>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,f),a=u,l=f;(i=a<2?n:l)||!d;){o||(a?a<3?(a>1&&(h.n=-1),m(a,l)):h.n=l:h.v=l);try{if(s=2,o){if(a||(r="next"),i=o[r]){if(!(i=i.call(o,l)))throw TypeError("iterator result is not an object");if(!i.done)return i;l=i.value,a<2&&(a=0)}else 1===a&&(i=o.return)&&i.call(o),a<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=n}else if((i=(d=h.n<0)?l:e.call(t,h))!==c)break}catch(e){o=n,a=1,l=e}finally{s=1}}return{value:i,done:d}}}(e,o,a),!0),u}var c={};function s(){}function u(){}function d(){}i=Object.getPrototypeOf;var h=[][o]?i(i([][o]())):(t(i={},o,function(){return this}),i),m=d.prototype=s.prototype=Object.create(h);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,t(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=d,t(m,"constructor",d),t(d,"constructor",u),u.displayName="GeneratorFunction",t(d,a,"GeneratorFunction"),t(m),t(m,a,"Generator"),t(m,o,function(){return this}),t(m,"toString",function(){return"[object Generator]"}),(e=function(){return{w:l,m:f}})()}function t(e,n,i,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}t=function(e,n,i,r){function a(n,i){t(e,n,function(e){return this._invoke(n,i,e)})}n?o?o(e,n,{value:i,enumerable:!r,configurable:!r,writable:!r}):e[n]=i:(a("next",0),a("throw",1),a("return",2))},t(e,n,i,r)}function n(e,t,n,i,r,o,a){try{var l=e[o](a),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(i,r)}function i(e,t){return r.apply(this,arguments)}function r(){var t;return t=e().m(function t(n,i){var r,o,a,l,c;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return o=null===(r=document.querySelector('meta[name="csrf-token"]'))||void 0===r?void 0:r.getAttribute("content"),e.p=1,e.n=2,fetch("/media-picker/".concat(n),{method:"POST",body:i,headers:{"X-CSRF-TOKEN":o,Accept:"application/json"}});case 2:return a=e.v,e.n=3,a.json();case 3:if(l=e.v,a.ok){e.n=4;break}throw new Error(l.message||"An unknown error occurred.");case 4:return e.a(2,l);case 5:throw e.p=5,c=e.v,alert(c.message),c;case 6:return e.a(2)}},t,null,[[1,5]])}),r=function(){var e=this,i=arguments;return new Promise(function(r,o){var a=t.apply(e,i);function l(e){n(a,r,o,l,c,"next",e)}function c(e){n(a,r,o,l,c,"throw",e)}l(void 0)})},r.apply(this,arguments)}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,l(i.key),i)}}function l(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}var c=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=null,this.promise=null,this.state={selectedPath:null},this._handleTreeClick=this._handleTreeClick.bind(this),this._handleConfirmClick=this._handleConfirmClick.bind(this),this._handleCancelClick=this._handleCancelClick.bind(this),this._handleBackdropClick=this._handleBackdropClick.bind(this)},t=[{key:"open",value:function(e,t){var n=this;return new Promise(function(i){n.promise={resolve:i},n._createModalElement(),n.render(e,t),n.attachEventListeners(),n.element.style.display="flex"})}},{key:"_createModalElement",value:function(){var e=document.createElement("div");e.className="ms-media-folder-modal-backdrop",e.innerHTML='\n            <div class="ms-media-folder-modal-content">\n                <h4>Select Destination Folder</h4>\n                <div class="ms-media-folder-modal-tree"></div>\n                <div class="ms-media-folder-modal-actions">\n                    <button type="button" class="ms-media-btn ms-folder-modal-cancel-btn">Cancel</button>\n                    <button type="button" class="ms-media-btn ms-media-btn-primary ms-folder-modal-move-btn" disabled>Move Here</button>\n                </div>\n            </div>\n        ',document.body.appendChild(e),this.element=e}},{key:"render",value:function(e,t){var n=function(e){var i="<ul>";return e.forEach(function(e){var r=e.path===t;i+='<li><a href="#" class="'.concat(r?"disabled":"",'" data-path="').concat(e.path,'" title="').concat(r?"Current folder":"",'">üìÅ ').concat(e.name,"</a>"),e.children&&e.children.length>0&&(i+=n(e.children)),i+="</li>"}),i+="</ul>"};this.element.querySelector(".ms-media-folder-modal-tree").innerHTML=n(e)}},{key:"attachEventListeners",value:function(){this.ui={tree:this.element.querySelector(".ms-media-folder-modal-tree"),moveBtn:this.element.querySelector(".ms-media-folder-modal-move-btn"),cancelBtn:this.element.querySelector(".ms-media-folder-modal-cancel-btn")},this.ui.tree.addEventListener("click",this._handleTreeClick),this.ui.moveBtn.addEventListener("click",this._handleConfirmClick),this.ui.cancelBtn.addEventListener("click",this._handleCancelClick),this.element.addEventListener("click",this._handleBackdropClick)}},{key:"_handleTreeClick",value:function(e){e.preventDefault();var t=e.target.closest("a");t&&!t.classList.contains("disabled")&&(this.ui.tree.querySelectorAll("a").forEach(function(e){return e.classList.remove("selected")}),t.classList.add("selected"),this.state.selectedPath=t.dataset.path,this.ui.moveBtn.disabled=!1)}},{key:"_handleConfirmClick",value:function(){this._resolveAndClose(this.state.selectedPath)}},{key:"_handleCancelClick",value:function(){this._resolveAndClose(null)}},{key:"_handleBackdropClick",value:function(e){e.target===this.element&&this._resolveAndClose(null)}},{key:"_resolveAndClose",value:function(e){this.promise&&this.promise.resolve(e),this.element.remove()}}],t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();const s=c;function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function h(e,t,n){return(t=f(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,f(i.key),i)}}function f(e){var t=function(e,t){if("object"!=u(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=u(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==u(t)?t:t+""}var p=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=null,this.promise=null,this.config=null},t=[{key:"open",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.config=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach(function(t){h(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({title:"Enter a value",confirmText:"OK",fields:[]},t),new Promise(function(t){e.promise={resolve:t},e._createModalElement(),e.attachEventListeners(),e.element.style.display="flex";var n=e.element.querySelector('input[type="text"], input[type="url"]');n&&(n.focus(),n.select())})}},{key:"_createModalElement",value:function(){var e=document.createElement("div");e.className="ms-dialog-backdrop";var t=this.config.fields.map(function(e){return"checkbox"===e.type?'\n                    <div class="ms-dialog-group checkbox">\n                        <input type="checkbox" id="ms-prompt-input-'.concat(e.name,'" name="').concat(e.name,'" ').concat(e.checked?"checked":"",'>\n                        <label for="ms-prompt-input-').concat(e.name,'">').concat(e.label,"</label>\n                    </div>\n                "):'\n                <div class="ms-dialog-group">\n                    <label for="ms-prompt-input-'.concat(e.name,'">').concat(e.label,'</label>\n                    <input type="').concat(e.type||"text",'" id="ms-prompt-input-').concat(e.name,'" name="').concat(e.name,'" value="').concat(e.value||"",'" placeholder="').concat(e.placeholder||"",'">\n                </div>\n            ')}).join("");e.innerHTML='\n            <div class="ms-dialog-content">\n                <div class="ms-dialog-header">\n                    <h4>'.concat(this.config.title,'</h4>\n                    <button type="button" class="ms-dialog-close">&times;</button>\n                </div>\n                <div class="ms-dialog-body">').concat(t,'</div>\n                <div class="ms-dialog-footer">\n                    <button type="button" class="ms-media-btn ms-prompt-cancel-btn">Cancel</button>\n                    <button type="button" class="ms-media-btn ms-media-btn-primary ms-prompt-confirm-btn">').concat(this.config.confirmText,"</button>\n                </div>\n            </div>\n        "),document.body.appendChild(e),this.element=e}},{key:"attachEventListeners",value:function(){var e=this,t=this.element.querySelector(".ms-prompt-confirm-btn"),n=this.element.querySelector(".ms-prompt-cancel-btn"),i=this.element.querySelector(".ms-dialog-close");t.onclick=function(){return e._handleConfirm()},n.onclick=function(){return e._resolveAndClose(null)},i.onclick=function(){return e._resolveAndClose(null)},this.element.addEventListener("click",function(t){t.target===e.element&&e._resolveAndClose(null)})}},{key:"_handleConfirm",value:function(){var e=this,t={};this.config.fields.forEach(function(n){var i=e.element.querySelector('[name="'.concat(n.name,'"]'));i&&(t[n.name]="checkbox"===n.type?i.checked:i.value)}),this._resolveAndClose(t)}},{key:"_resolveAndClose",value:function(e){this.promise&&this.promise.resolve(e),this.element.remove()}}],t&&m(e.prototype,t),n&&m(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();const v=p;function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,g(i.key),i)}}function g(e){var t=function(e,t){if("object"!=y(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=y(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==y(t)?t:t+""}var k,w,C,S=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},n=[{key:"_getContainer",value:function(){if(!this.container&&(this.container=document.createElement("div"),this.container.id="ms-toast-container",document.body.appendChild(this.container),!document.getElementById("ms-toast-animations"))){var e=document.createElement("style");e.id="ms-toast-animations",e.innerHTML="\n                    @keyframes ms-toast-fade-in {\n                        to { opacity: 1; transform: translateY(0); }\n                    }\n                    @keyframes ms-toast-fade-out {\n                        to { opacity: 0; transform: translateY(20px); }\n                    }\n                ",document.head.appendChild(e)}return this.container}},{key:"show",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,i=this._getContainer(),r=document.createElement("div");r.className="ms-toast ".concat(t),r.textContent=e,i.appendChild(r),setTimeout(function(){r.style.animation="ms-toast-fade-out 0.3s forwards",r.addEventListener("animationend",function(){return r.remove()})},n)}}],(t=null)&&b(e.prototype,t),n&&b(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();k=S,C=null,(w=g(w="container"))in k?Object.defineProperty(k,w,{value:C,enumerable:!0,configurable:!0,writable:!0}):k[w]=C;const E=S;function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function T(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,P(i.key),i)}}function P(e){var t=function(e,t){if("object"!=_(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=_(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==_(t)?t:t+""}var I=function(){return function(e,t,n){return t&&T(e.prototype,t),n&&T(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.module=t,this.isDebug=!0===window.mediaPickerDebug},[{key:"log",value:function(){if(this.isDebug){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).log.apply(e,["[".concat(this.module,"]")].concat(n))}}},{key:"info",value:function(){if(this.isDebug){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).log.apply(e,["%c[".concat(this.module,"]"),"color: green; font-weight: bold;"].concat(n))}}},{key:"warn",value:function(){if(this.isDebug){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).warn.apply(e,["[".concat(this.module,"]")].concat(n))}}},{key:"error",value:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).error.apply(e,["[".concat(this.module,"]")].concat(n))}}])}();const L=I;function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function j(){var e,t,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof l?i:l,s=Object.create(c.prototype);return F(s,"_invoke",function(n,i,r){var o,l,c,s=0,u=r||[],d=!1,h={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return o=t,l=0,c=e,h.n=n,a}};function m(n,i){for(l=n,c=i,t=0;!d&&s&&!r&&t<u.length;t++){var r,o=u[t],m=h.p,f=o[2];n>3?(r=f===i)&&(c=o[(l=o[4])?5:(l=3,3)],o[4]=o[5]=e):o[0]<=m&&((r=n<2&&m<o[1])?(l=0,h.v=i,h.n=o[1]):m<f&&(r=n<3||o[0]>i||i>f)&&(o[4]=n,o[5]=i,h.n=f,l=0))}if(r||n>1)return a;throw d=!0,i}return function(r,u,f){if(s>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,f),l=u,c=f;(t=l<2?e:c)||!d;){o||(l?l<3?(l>1&&(h.n=-1),m(l,c)):h.n=c:h.v=c);try{if(s=2,o){if(l||(r="next"),t=o[r]){if(!(t=t.call(o,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,l<2&&(l=0)}else 1===l&&(t=o.return)&&t.call(o),l<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),l=1);o=e}else if((t=(d=h.n<0)?c:n.call(i,h))!==a)break}catch(t){o=e,l=1,c=t}finally{s=1}}return{value:t,done:d}}}(n,r,o),!0),s}var a={};function l(){}function c(){}function s(){}t=Object.getPrototypeOf;var u=[][i]?t(t([][i]())):(F(t={},i,function(){return this}),t),d=s.prototype=l.prototype=Object.create(u);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,F(e,r,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=s,F(d,"constructor",s),F(s,"constructor",c),c.displayName="GeneratorFunction",F(s,r,"GeneratorFunction"),F(d),F(d,r,"Generator"),F(d,i,function(){return this}),F(d,"toString",function(){return"[object Generator]"}),(j=function(){return{w:o,m:h}})()}function F(e,t,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}F=function(e,t,n,i){function o(t,n){F(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!i,configurable:!i,writable:!i}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},F(e,t,n,i)}function M(e,t,n,i,r,o,a){try{var l=e[o](a),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(i,r)}function A(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){var o=e.apply(t,n);function a(e){M(o,i,r,a,l,"next",e)}function l(e){M(o,i,r,a,l,"throw",e)}a(void 0)})}}function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function D(e,t,n){return(t=B(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,B(i.key),i)}}function B(e){var t=function(e,t){if("object"!=O(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=O(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==O(t)?t:t+""}var N=new L("MediaPicker"),R=function(){return function(e,t,n){return t&&q(e.prototype,t),n&&q(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),N.log("Constructor called for element:",t,"with options:",n),this.element=t,this.options=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach(function(t){D(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({isInline:!1,onSelect:null},n),this.state={currentPath:"/",selectedFile:null,searchTerm:"",mediaFilter:"all",contents:{files:[],directories:[],all_directories:[]}},this.ui={body:this.element.querySelector(".ms-media-body"),breadcrumbs:this.element.querySelector(".ms-media-breadcrumbs"),loader:this.element.querySelector(".ms-media-loader"),selectBtn:this.element.querySelector(".ms-select-file-btn"),actionsPanel:this.element.querySelector(".ms-media-actions-panel"),createFolderBtn:this.element.querySelector(".ms-create-folder-btn"),uploadInput:this.element.querySelector(".ms-upload-file-input"),searchInput:this.element.querySelector(".ms-media-search-input"),folderTree:this.element.querySelector(".ms-media-folder-tree")},this.handlers={},!this.ui.body)return N.error("CRITICAL: Could not find .ms-media-body. Aborting initialization.");this.attachEventListeners(),this.loadContents("/")},[{key:"attachEventListeners",value:function(){var e=this;N.log("Attaching event listeners."),this.handlers.onBodyClick=function(t){return e.handleItemClick(t)},this.handlers.onFolderTreeClick=function(t){return e.handleFolderTreeClick(t)},this.handlers.onCreateFolderClick=function(){return e.createFolder()},this.handlers.onUploadInputChange=function(t){return e.uploadFile(t)},this.handlers.onBreadcrumbClick=function(t){return e.handleBreadcrumbClick(t)},this.handlers.onSelectBtnClick=function(){return e.handleSelect()},this.handlers.onSearchInput=function(t){return e.handleSearchInput(t)},this.ui.body&&this.ui.body.addEventListener("click",this.handlers.onBodyClick),this.ui.folderTree&&this.ui.folderTree.addEventListener("click",this.handlers.onFolderTreeClick),this.ui.createFolderBtn&&this.ui.createFolderBtn.addEventListener("click",this.handlers.onCreateFolderClick),this.ui.uploadInput&&this.ui.uploadInput.addEventListener("change",this.handlers.onUploadInputChange);var t=this.element.querySelector(".ms-media-actions");if(this.handlers.onActionsClick=function(t){return e.handleActionsClick(t)},t&&t.addEventListener("click",this.handlers.onActionsClick),this.ui.breadcrumbs&&this.ui.breadcrumbs.addEventListener("click",this.handlers.onBreadcrumbClick),this.ui.selectBtn&&this.ui.selectBtn.addEventListener("click",this.handlers.onSelectBtnClick),this.ui.searchInput&&this.ui.searchInput.addEventListener("input",this.handlers.onSearchInput),this.ui.actionsPanel){var n=function(t){return e.ui.actionsPanel.querySelector(t)},i=n(".actions-panel-close"),r=n(".copy-url-btn"),o=n(".get-resized-url-btn"),a=n(".rename-btn"),l=n(".move-btn"),c=n(".delete-btn");i&&i.addEventListener("click",function(){return e.hideActionsPanel()}),r&&r.addEventListener("click",function(){return e.copyToClipboard(".file-url-input")}),o&&o.addEventListener("click",function(){return e.getResizedUrl()}),a&&a.addEventListener("click",function(){return e.renameItem()}),l&&l.addEventListener("click",function(){return e.moveItem()}),c&&c.addEventListener("click",function(){return e.deleteItem()})}}},{key:"loadContents",value:(l=A(j().m(function e(t){var n,i,r,o;return j().w(function(e){for(;;)switch(e.p=e.n){case 0:return N.log('Loading contents for folder: "'.concat(t,'"')),this.showLoader(!0),this.hideActionsPanel(),this.state.currentPath=t,e.p=1,n=this.state.searchTerm?"&search=".concat(encodeURIComponent(this.state.searchTerm)):"",i=this.state.mediaFilter&&"all"!==this.state.mediaFilter?"&type=".concat(encodeURIComponent(this.state.mediaFilter)):"",e.n=2,fetch("/media-picker/get-contents?folder=".concat(encodeURIComponent(t)).concat(n).concat(i)).then(function(e){return e.json()});case 2:r=e.v,this.state.contents=r,N.log("Contents loaded successfully:",r),this.render(),e.n=4;break;case 3:e.p=3,o=e.v,N.error("Failed to load contents:",o);case 4:return e.p=4,this.showLoader(!1),e.f(4);case 5:return e.a(2)}},e,this,[[1,3,4,5]])})),function(e){return l.apply(this,arguments)})},{key:"handleSearchInput",value:function(e){var t=this,n=e.target.value.trim();this.searchDebounce&&clearTimeout(this.searchDebounce),this.searchDebounce=setTimeout(function(){t.state.searchTerm=n,t.loadContents(t.state.currentPath)},250)}},{key:"handleActionsClick",value:function(e){var t=e.target.closest(".ms-media-filter-btn");if(t){var n=t.dataset.filter||"all",i=this.element.querySelector(".ms-media-filters");i&&i.querySelectorAll(".ms-media-filter-btn").forEach(function(e){return e.classList.toggle("active",e===t)}),this.state.mediaFilter!==n&&(this.state.mediaFilter=n,this.loadContents(this.state.currentPath))}}},{key:"render",value:function(){var e=this;N.log("Rendering UI with current state."),this.ui.breadcrumbs&&(this.ui.breadcrumbs.innerHTML=this.state.contents.breadcrumbs.map(function(t,n){return n===e.state.contents.breadcrumbs.length-1?"<span>".concat(t.name,"</span>"):'<a href="#" data-path="'.concat(t.path,'">').concat(t.name,"</a> &gt;")}).join(" ")),this.ui.body&&(this.ui.body.innerHTML="",this.state.contents.directories.forEach(function(t){return e.ui.body.insertAdjacentHTML("beforeend",e.renderItem(t))}),this.state.contents.files.forEach(function(t){return e.ui.body.insertAdjacentHTML("beforeend",e.renderItem(t))})),this.ui.folderTree&&(this.ui.folderTree.innerHTML=this.buildTreeHTML(this.state.contents.all_directories))}},{key:"buildTreeHTML",value:function(e){var t=this,n="<ul>";return e.forEach(function(e){var i=t.state.currentPath===e.path;n+='<li><a href="#" class="'.concat(i?"active":"",'" data-path="').concat(e.path,'">üìÅ ').concat(e.name,"</a>"),e.children&&e.children.length>0&&(n+=t.buildTreeHTML(e.children)),n+="</li>"}),n+="</ul>"}},{key:"handleItemClick",value:function(e){var t=e.target.closest(".ms-media-item");if(t){var n=t.dataset.type;N.log("Item clicked. Type: ".concat(n,", Path: ").concat(t.dataset.path)),"directory"===n?this.loadContents(t.dataset.path):this.selectItem(t)}}},{key:"handleFolderTreeClick",value:function(e){e.preventDefault();var t=e.target.closest("a");t&&t.dataset.path&&(N.log("Folder tree link clicked. Path: ".concat(t.dataset.path)),this.loadContents(t.dataset.path))}},{key:"selectItem",value:function(e){this.element.querySelectorAll(".ms-media-item.selected").forEach(function(e){return e.classList.remove("selected")}),e.classList.add("selected"),this.state.selectedFile=JSON.parse(e.dataset.item),N.log("File selected:",this.state.selectedFile),this.ui.selectBtn&&(this.ui.selectBtn.disabled="file"!==this.state.selectedFile.type),"file"===this.state.selectedFile.type?this.options.isInline?this.showActionsPanel():(N.log("Modal picker file selected, calling handleSelect()."),this.handleSelect()):this.hideActionsPanel()}},{key:"renderItem",value:function(e){var t=e.is_image?'<img src="'.concat(e.url,'" alt="').concat(e.name,'" loading="lazy">'):'<div class="ms-media-item-icon">'.concat("directory"===e.type?"üìÅ":"üìÑ","</div>");return'\n            <div class="ms-media-item" data-path="'.concat(e.path,'" data-type="').concat(e.type,"\" data-item='").concat(JSON.stringify(e),"'>\n                ").concat(t,'\n                <div class="ms-media-item-name">').concat(e.name,"</div>\n            </div>\n        ")}},{key:"handleSelect",value:function(){if(this.state.selectedFile&&"file"===this.state.selectedFile.type&&this.options.onSelect){var e={name:this.state.selectedFile.name,url:this.state.selectedFile.public_url,path:this.state.selectedFile.path,size:this.state.selectedFile.size,is_image:this.state.selectedFile.is_image};N.log("Executing onSelect callback with file:",e),this.options.onSelect(e)}else N.warn("handleSelect called but no file selected or no onSelect callback provided.")}},{key:"handleBreadcrumbClick",value:function(e){e.preventDefault(),"A"===e.target.tagName&&(N.log("Breadcrumb clicked. Path: ".concat(e.target.dataset.path)),this.loadContents(e.target.dataset.path))}},{key:"showActionsPanel",value:function(){var e=this.state.selectedFile;if(e&&this.ui.actionsPanel){N.log("Showing actions panel for file:",e.name);var t=this.ui.actionsPanel;t.querySelector(".file-name").textContent=e.name,t.querySelector(".file-size").textContent="".concat((e.size/1024).toFixed(2)," KB"),t.querySelector(".file-modified").textContent="Modified: ".concat(new Date(1e3*e.last_modified).toLocaleDateString()),t.querySelector(".file-url-input").value=e.public_url,t.querySelector(".actions-panel-preview").innerHTML=e.is_image?'<img src="'.concat(e.url,'" alt="Preview">'):'<div class="file-icon">üìÑ</div>',t.style.display="flex"}}},{key:"hideActionsPanel",value:function(){this.state.selectedFile&&(N.log("Hiding actions panel."),this.state.selectedFile=null,this.ui.selectBtn&&(this.ui.selectBtn.disabled=!0),this.element.querySelectorAll(".ms-media-item.selected").forEach(function(e){return e.classList.remove("selected")}),this.ui.actionsPanel&&(this.ui.actionsPanel.style.display="none"))}},{key:"createFolder",value:(a=A(j().m(function e(){var t,n,r,o=this;return j().w(function(e){for(;;)switch(e.n){case 0:return N.log("Create folder button clicked."),t=new v,e.n=1,t.open({title:"Create New Folder",confirmText:"Create",fields:[{name:"folder_name",label:"Folder Name"}]});case 1:if(!(n=e.v)||!n.folder_name){e.n=3;break}return N.log('Creating folder "'.concat(n.folder_name,'" in path "').concat(this.state.currentPath,'"')),(r=new FormData).append("folder_name",n.folder_name),r.append("current_path",this.state.currentPath),e.n=2,i("create-folder",r).then(function(){E.show("Folder created."),o.loadContents(o.state.currentPath)}).catch(function(){});case 2:e.n=4;break;case 3:N.log("Create folder prompt cancelled.");case 4:return e.a(2)}},e,this)})),function(){return a.apply(this,arguments)})},{key:"uploadFile",value:(o=A(j().m(function e(t){var n,r,o=this;return j().w(function(e){for(;;)switch(e.n){case 0:if(n=t.target.files[0]){e.n=1;break}return e.a(2);case 1:return N.log('Uploading file "'.concat(n.name,'" to path "').concat(this.state.currentPath,'"')),(r=new FormData).append("file",n),r.append("current_path",this.state.currentPath),e.n=2,i("upload",r).then(function(){E.show("File uploaded."),o.loadContents(o.state.currentPath)}).catch(function(){});case 2:t.target.value="";case 3:return e.a(2)}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"renameItem",value:(r=A(j().m(function e(){var t,n,r,o,a=this;return j().w(function(e){for(;;)switch(e.n){case 0:if(t=this.state.selectedFile){e.n=1;break}return e.a(2);case 1:return N.log("Rename button clicked for item:",t),n=new v,e.n=2,n.open({title:"Rename ".concat(t.type),confirmText:"Rename",fields:[{name:"new_name",label:"New Name",value:t.name}]});case 2:if(!(r=e.v)||!r.new_name||r.new_name===t.name){e.n=4;break}return N.log('Renaming item from "'.concat(t.name,'" to "').concat(r.new_name,'"')),(o=new FormData).append("path",t.path),o.append("new_name",r.new_name),e.n=3,i("rename",o).then(function(){E.show("Item renamed successfully."),a.loadContents(a.state.currentPath)}).catch(function(){});case 3:e.n=5;break;case 4:N.log("Rename prompt cancelled or name unchanged.");case 5:return e.a(2)}},e,this)})),function(){return r.apply(this,arguments)})},{key:"moveItem",value:(n=A(j().m(function e(){var t,n,r,o,a,l=this;return j().w(function(e){for(;;)switch(e.n){case 0:if(t=this.state.selectedFile){e.n=1;break}return e.a(2);case 1:return N.log("Move button clicked for item:",t),n=t.path.substring(0,t.path.lastIndexOf("/"))||"/",r=new s,e.n=2,r.open(this.state.contents.all_directories,n);case 2:if(null===(o=e.v)){e.n=4;break}return N.log('Moving item to destination: "'.concat(o,'"')),(a=new FormData).append("path",t.path),a.append("destination",o),e.n=3,i("move",a).then(function(){E.show("Item moved successfully."),l.loadContents(l.state.currentPath)}).catch(function(){});case 3:e.n=5;break;case 4:N.log("Move prompt cancelled.");case 5:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"getResizedUrl",value:(t=A(j().m(function e(){var t,n,i,r,o,a,l,c,s,u;return j().w(function(e){for(;;)switch(e.n){case 0:if((t=this.state.selectedFile)&&t.is_image){e.n=1;break}return n="Please select an image file.",N.warn(n),e.a(2,E.show(n,"error"));case 1:return N.log("Get resized URL clicked for image:",t.name),i=new v,e.n=2,i.open({title:"Get Resized URL - Step 1 of 2",confirmText:"Next",fields:[{name:"width",label:'Enter desired width (e.g., 300, or "w" for auto-height)'}]});case 2:if((r=e.v)&&r.width){e.n=3;break}return e.a(2,N.log("Resize prompt step 1 cancelled."));case 3:return e.n=4,i.open({title:"Get Resized URL - Step 2 of 2",confirmText:"Generate",fields:[{name:"height",label:'Enter desired height (e.g., 200, or "h" for auto-width)'}]});case 4:if((o=e.v)&&o.height){e.n=5;break}return e.a(2,N.log("Resize prompt step 2 cancelled."));case 5:a=t.path.replace(/^uploads\//,""),l=a.lastIndexOf("/"),c="",s=a,-1!==l&&(c=a.substring(0,l),s=a.substring(l+1)),u="".concat(window.location.origin,"/uploads/").concat(c,"/").concat(r.width,"/").concat(o.height,"/").concat(s),N.log("Generated resized URL: ".concat(u)),this.ui.actionsPanel.querySelector(".file-url-input").value=u,E.show("Resized URL generated in the input box.");case 6:return e.a(2)}},e,this)})),function(){return t.apply(this,arguments)})},{key:"deleteItem",value:(e=A(j().m(function e(){var t,n,r=this;return j().w(function(e){for(;;)switch(e.n){case 0:if(t=this.state.selectedFile){e.n=1;break}return e.a(2);case 1:if(N.log("Delete button clicked for item:",t.name),confirm('Are you sure you want to delete "'.concat(t.name,'"?'))){e.n=2;break}return e.a(2,N.log("Delete confirmation cancelled."));case 2:return N.log("Deleting item..."),(n=new FormData).append("path",t.path),n.append("type",t.type),e.n=3,i("delete",n).then(function(){E.show("Item deleted."),r.loadContents(r.state.currentPath)}).catch(function(){});case 3:return e.a(2)}},e,this)})),function(){return e.apply(this,arguments)})},{key:"copyToClipboard",value:function(e){N.log('Copying content of "'.concat(e,'" to clipboard.')),this.ui.actionsPanel.querySelector(e).select(),document.execCommand("copy"),E.show("Copied to clipboard!")}},{key:"showLoader",value:function(e){N.log(e?"Showing loader.":"Hiding loader."),this.ui.loader&&(this.ui.loader.style.display=e?"flex":"none")}},{key:"destroy",value:function(){N.warn("Destroying instance, removing event listeners."),this.ui.body&&this.ui.body.removeEventListener("click",this.handlers.onBodyClick),this.ui.folderTree&&this.ui.folderTree.removeEventListener("click",this.handlers.onFolderTreeClick),this.ui.createFolderBtn&&this.ui.createFolderBtn.removeEventListener("click",this.handlers.onCreateFolderClick),this.ui.uploadInput&&this.ui.uploadInput.removeEventListener("change",this.handlers.onUploadInputChange),this.ui.breadcrumbs&&this.ui.breadcrumbs.removeEventListener("click",this.handlers.onBreadcrumbClick),this.ui.selectBtn&&this.ui.selectBtn.removeEventListener("click",this.handlers.onSelectBtnClick),this.element=null,this.ui={},this.handlers={},N.log("MediaPicker instance destroyed.")}}]);var e,t,n,r,o,a,l}();window.MSSMediaPicker=R;const H=R;var U={modalEl:null,pickerInstance:null,currentCallback:null,getPickerHTML:function(e){return'\n            <div class="ms-media-picker-container" data-is-inline="false">\n                <div class="ms-media-header">\n                    <nav class="ms-media-breadcrumbs"></nav>\n                    <div class="ms-media-actions">\n                        <div class="ms-media-filters">\n                            <button type="button" class="ms-media-filter-btn active" data-filter="all">All</button>\n                            <button type="button" class="ms-media-filter-btn" data-filter="image">Images</button>\n                            <button type="button" class="ms-media-filter-btn" data-filter="video">Videos</button>\n                        </div>\n                        <div class="ms-media-search">\n                            <input type="search" class="ms-media-search-input" placeholder="Search files, folders, date (YYYY-MM-DD)">\n                        </div>\n                        <button type="button" class="ms-media-btn ms-create-folder-btn">New Folder</button>\n                        <label class="ms-media-btn ms-media-btn-primary">\n                            Upload File <input type="file" class="ms-upload-file-input" style="display: none;" accept="'.concat(e,'">\n                        </label>\n                    </div>\n                </div>\n                <div class="ms-media-body-wrapper">\n                    <div class="ms-media-sidebar">\n                        <div class="sidebar-header">Folders</div>\n                        <div class="ms-media-folder-tree"></div>\n                    </div>\n                    <div class="ms-media-body"></div>\n                </div>\n                <div class="ms-media-footer">\n                    <div class="ms-media-selection-info"></div>\n                    <button type="button" class="ms-media-btn ms-media-btn-primary ms-select-file-btn" disabled>Select File</button>\n                </div>\n                <div class="ms-media-loader" style="display: none;"><div class="spinner"></div></div>\n            </div>\n        ')},open:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.modalEl||this.init(),this.currentCallback=e,this.triggerElement=i;var r=this.modalEl.querySelector("#ms-modal-picker-placeholder");r.innerHTML=this.getPickerHTML(n);this.pickerInstance=new H(r.firstElementChild,{isInline:!1,onSelect:function(e){var n=new CustomEvent("ms-media-file-selected",{detail:{file:e,triggerElement:t.triggerElement}});document.dispatchEvent(n),t.currentCallback&&t.currentCallback(e),t.close()}}),this.modalEl.style.display="flex",document.body.style.overflow="hidden"},close:function(){this.modalEl&&(this.modalEl.style.display="none"),this.currentCallback=null,this.triggerElement=null,document.body.style.overflow="",this.modalEl.querySelector("#ms-modal-picker-placeholder").innerHTML="",this.pickerInstance=null},init:function(){var e=this;this.modalEl=document.createElement("div"),this.modalEl.className="ms-media-picker-modal-backdrop",this.modalEl.style.display="none",this.modalEl.innerHTML='<div class="ms-media-picker-modal-content"><button class="ms-media-modal-close">&times;</button><div id="ms-modal-picker-placeholder"></div></div>',document.body.appendChild(this.modalEl),this.modalEl.querySelector(".ms-media-modal-close").onclick=function(){return e.close()},this.modalEl.addEventListener("click",function(t){t.target===e.modalEl&&e.close()})}};const z=U;function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function V(){var e,t,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof l?i:l,s=Object.create(c.prototype);return Y(s,"_invoke",function(n,i,r){var o,l,c,s=0,u=r||[],d=!1,h={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return o=t,l=0,c=e,h.n=n,a}};function m(n,i){for(l=n,c=i,t=0;!d&&s&&!r&&t<u.length;t++){var r,o=u[t],m=h.p,f=o[2];n>3?(r=f===i)&&(c=o[(l=o[4])?5:(l=3,3)],o[4]=o[5]=e):o[0]<=m&&((r=n<2&&m<o[1])?(l=0,h.v=i,h.n=o[1]):m<f&&(r=n<3||o[0]>i||i>f)&&(o[4]=n,o[5]=i,h.n=f,l=0))}if(r||n>1)return a;throw d=!0,i}return function(r,u,f){if(s>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,f),l=u,c=f;(t=l<2?e:c)||!d;){o||(l?l<3?(l>1&&(h.n=-1),m(l,c)):h.n=c:h.v=c);try{if(s=2,o){if(l||(r="next"),t=o[r]){if(!(t=t.call(o,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,l<2&&(l=0)}else 1===l&&(t=o.return)&&t.call(o),l<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),l=1);o=e}else if((t=(d=h.n<0)?c:n.call(i,h))!==a)break}catch(t){o=e,l=1,c=t}finally{s=1}}return{value:t,done:d}}}(n,r,o),!0),s}var a={};function l(){}function c(){}function s(){}t=Object.getPrototypeOf;var u=[][i]?t(t([][i]())):(Y(t={},i,function(){return this}),t),d=s.prototype=l.prototype=Object.create(u);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,Y(e,r,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=s,Y(d,"constructor",s),Y(s,"constructor",c),c.displayName="GeneratorFunction",Y(s,r,"GeneratorFunction"),Y(d),Y(d,r,"Generator"),Y(d,i,function(){return this}),Y(d,"toString",function(){return"[object Generator]"}),(V=function(){return{w:o,m:h}})()}function Y(e,t,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}Y=function(e,t,n,i){function o(t,n){Y(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!i,configurable:!i,writable:!i}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},Y(e,t,n,i)}function K(e,t,n,i,r,o,a){try{var l=e[o](a),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(i,r)}function J(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,X(i.key),i)}}function X(e){var t=function(e,t){if("object"!=G(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=G(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==G(t)?t:t+""}var $=new L("Editor"),Q=function(){return function(e,t,n){return t&&J(e.prototype,t),n&&J(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),$.log("Constructor called for element:",t),this.element=t,this.ui={content:this.element.querySelector(".ms-editor-content"),code:this.element.querySelector(".ms-editor-code"),formInput:this.element.querySelector(".ms-editor-form-input"),toolbar:this.element.querySelector(".ms-editor-toolbar"),editModal:document.querySelector(".ms-media-edit-modal-backdrop")},$.log('UI "content" found:',this.ui.content),$.log('UI "code" found:',this.ui.code),$.log('UI "formInput" found:',this.ui.formInput),$.log('UI "toolbar" found:',this.ui.toolbar),this.state={codeViewActive:!1},this.savedSelection=null,this._initialized=!1,this.handlers={},this.contentObserver=null,this.ui.content&&this.ui.formInput&&this.ui.toolbar?this.init():$.error("CRITICAL: Could not find essential UI elements. Aborting initialization.")},[{key:"init",value:function(){var e=this;this._initialized||(this._initialized=!0,$.log("Init running."),this.ui.content.innerHTML=this.ui.formInput.value,this.ui.code.value=this.ui.formInput.value,this.handlers.onContentInput=function(){$.log('Content "input" event fired.');var t=e.ui.content.innerHTML;e.ui.formInput.value!==t&&(e.ui.formInput.value=t,e.ui.code.value=t,e.dispatchChange())},this.handlers.onCodeInput=function(){$.log('Code "input" event fired.');var t=e.ui.code.value;e.ui.formInput.value!==t&&(e.ui.content.innerHTML=t,e.ui.formInput.value=t,e.dispatchChange())},this.handlers.onFormInput=function(t){$.log("Form input event fired (syncing from Livewire)."),t.isTrusted&&e.ui.formInput.value!==e.ui.content.innerHTML&&(e.ui.content.innerHTML=e.ui.formInput.value,e.ui.code.value=e.ui.formInput.value,e.dispatchChange())},this.handlers.onToolbarClick=function(t){return e.handleToolbarClick(t)},this.handlers.onToolbarChange=function(t){return e.handleToolbarChange(t)},this.handlers.onToolbarMouseDown=function(t){t.preventDefault(),e.savedSelection=e.saveSelection()},this.handlers.onContentDblClick=function(t){return e.handleMediaDoubleClick(t)},this.contentObserver=new MutationObserver(this.handlers.onContentInput),this.contentObserver.observe(this.ui.content,{childList:!0,subtree:!0,characterData:!0}),this.ui.code.addEventListener("input",this.handlers.onCodeInput),this.ui.formInput.addEventListener("input",this.handlers.onFormInput),this.ui.toolbar.addEventListener("click",this.handlers.onToolbarClick),this.ui.toolbar.addEventListener("change",this.handlers.onToolbarChange),this.ui.toolbar.addEventListener("mousedown",this.handlers.onToolbarMouseDown),this.ui.content.addEventListener("dblclick",this.handlers.onContentDblClick),$.log("Editor event listeners attached (using MutationObserver)."))}},{key:"dispatchChange",value:function(){$.log("Dispatching custom event: ms-editor-content-changed"),this.ui.formInput.dispatchEvent(new Event("input",{bubbles:!0})),this.element.dispatchEvent(new CustomEvent("ms-editor-content-changed",{bubbles:!0,detail:{content:this.ui.content.innerHTML,plainText:this.ui.content.textContent,codeView:this.state.codeViewActive}}))}},{key:"handleToolbarClick",value:function(e){var t=e.target.closest("button");if(t){var n=t.dataset.command;if($.log("Toolbar button clicked. Command: ".concat(n)),t.parentElement.classList.contains("ms-editor-tool-wrapper"))return $.log("Color wrapper clicked, triggering color input."),void t.parentElement.querySelector('input[type="color"]').click();t.classList.contains("ms-code-view-btn")?this.toggleCodeView(t):t.classList.contains("ms-add-media-btn")?this.openMediaModal(t.dataset.mediaType,t):this.execCmd(n)}}},{key:"handleToolbarChange",value:function(e){var t=e.target.closest('select, input[type="color"]');if(t){var n=t.dataset.command,i=t.value;$.log("Toolbar input changed. Command: ".concat(n,", Value: ").concat(i)),this.execCmd(n,i)}}},{key:"toggleCodeView",value:function(e){this.state.codeViewActive=!this.state.codeViewActive,$.log("Toggling code view. New state: ".concat(this.state.codeViewActive?"active":"inactive")),e.classList.toggle("active",this.state.codeViewActive),this.ui.content.style.display=this.state.codeViewActive?"none":"block",this.ui.code.style.display=this.state.codeViewActive?"block":"none",this.state.codeViewActive&&(this.ui.code.value=this.ui.content.innerHTML)}},{key:"openMediaModal",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;$.log("Opening media modal for media type: ".concat(e));var i=this.saveSelection();z.open(function(n){$.log("Media modal selected file:",n);var r=n.name.match(/\.(jpeg|jpg|gif|png|webp|svg)$/i),o=n.name.match(/\.(mp4|webm|ogg)$/i);if("image"===e&&!r||"video"===e&&!o){var a="Please select a valid ".concat(e," file.");return $.warn(a),E.show(a,"error")}t.openEditDialog({type:e,src:n.url,alt:n.name},i)},"",n)}},{key:"handleMediaDoubleClick",value:function(e){var t=e.target;if($.log("Double click detected in content area on:",t),"IMG"===t.tagName||"VIDEO"===t.tagName){e.preventDefault(),$.log("Double click was on an IMG or VIDEO, opening edit dialog.");var n="";"left"===t.style.float||"right"===t.style.float?n=t.style.float:"block"===t.style.display&&"auto"===t.style.marginLeft&&"auto"===t.style.marginRight&&(n="center");var i={type:t.tagName.toLowerCase(),src:t.getAttribute("src"),alt:t.alt,width:t.style.width.replace("px",""),height:t.style.height.replace("px",""),id:t.id,className:t.className,align:n};this.openEditDialog(i,null,t)}}},{key:"openEditDialog",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if($.log("Opening edit dialog. Editing existing element: ".concat(!!i),e),!this.ui.editModal)return $.error("Edit Media Modal not found in DOM.");var r=this.ui.editModal,o=r.querySelector("#ms-media-edit-title"),a=r.querySelector("#ms-media-edit-preview-img"),l=r.querySelector("#ms-media-edit-preview-video"),c=r.querySelector("#ms-media-edit-alt"),s=r.querySelector("#ms-media-edit-width"),u=r.querySelector("#ms-media-edit-height"),d=r.querySelector("#ms-media-edit-align"),h=r.querySelector("#ms-media-edit-class"),m=r.querySelector("#ms-media-edit-id"),f=r.querySelector("#ms-media-edit-insert-btn"),p=r.querySelector("#ms-media-edit-cancel-btn"),v=r.querySelector(".ms-media-edit-modal-close");o.textContent=i?"Edit Media":"Insert Media",f.textContent=i?"Update":"Insert",a.style.display="none",l.style.display="none","image"===e.type||"img"===e.type?(a.style.display="block",a.src=e.src):"video"===e.type&&(l.style.display="block",l.src=e.src,l.load()),c.value=e.alt||"",s.value=e.width||"",u.value=e.height||"",d.value=e.align||"",h.value=e.className||"",m.value=e.id||"",r.style.display="flex";var y=function(){$.log("Cleaning up and closing edit dialog."),r.style.display="none",f.onclick=null,p.onclick=null,v.onclick=null};f.onclick=function(){var r;$.log("Insert/Update button clicked in edit dialog."),i?r=i:(r=document.createElement("image"===e.type?"img":e.type)).src=e.src,r.alt=c.value,r.id=m.value,r.className=h.value,r.style.width=s.value?"".concat(s.value,"px"):"",r.style.height=u.value?"".concat(u.value,"px"):"";var o=d.value;r.style.float="left"===o||"right"===o?o:"",r.style.display="center"===o?"block":"",r.style.marginLeft="center"===o?"auto":"",r.style.marginRight="center"===o?"auto":"",i||n._insertHtmlAtSelection(r,t),n.handlers.onContentInput(),y()},p.onclick=y,v.onclick=y}},{key:"_insertHtmlAtSelection",value:function(e,t){$.log("Inserting element at saved selection:",e),this.restoreSelection(t);var n=window.getSelection();if(0!==n.rangeCount){var i=n.getRangeAt(0);i.deleteContents(),i.insertNode(e);var r=document.createRange();r.setStartAfter(e),r.collapse(!0),n.removeAllRanges(),n.addRange(r)}else this.ui.content.appendChild(e)}},{key:"execCmd",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e&&(this.restoreSelection(this.savedSelection),$.log("Executing command: ".concat(e," with value: ").concat(t)),"createLink"!==e?(document.execCommand(e,!1,t),this.ui.content.focus(),this.handlers.onContentInput()):this.openLinkDialog())}},{key:"openLinkDialog",value:(e=V().m(function e(){var t,n,i,r,o,a;return V().w(function(e){for(;;)switch(e.n){case 0:if($.log("Opening link dialog."),t=this.saveSelection(),(n=this._getAnchorElement(t))||!t||!t.collapsed){e.n=1;break}return i="Please select some text to create a link.",$.warn(i),e.a(2,E.show(i,"error"));case 1:return r=new v,e.n=2,r.open({title:n?"Edit Link":"Insert Link",confirmText:n?"Update":"Insert",fields:[{type:"url",name:"url",label:"URL",value:n?n.getAttribute("href"):"https://",placeholder:"https://example.com"},{type:"checkbox",name:"newTab",label:"Open in new tab",checked:!!n&&"_blank"===n.target}]});case 2:o=e.v,this.restoreSelection(t),o&&o.url?($.log("Link dialog submitted with result:",o),document.execCommand("createLink",!1,o.url),(a=this._getAnchorElement(window.getSelection().getRangeAt(0)))&&(o.newTab?(a.target="_blank",a.rel="noopener noreferrer"):(a.removeAttribute("target"),a.removeAttribute("rel"))),this.handlers.onContentInput()):$.log("Link dialog was cancelled or submitted with no URL.");case 3:return e.a(2)}},e,this)}),t=function(){var t=this,n=arguments;return new Promise(function(i,r){var o=e.apply(t,n);function a(e){K(o,i,r,a,l,"next",e)}function l(e){K(o,i,r,a,l,"throw",e)}a(void 0)})},function(){return t.apply(this,arguments)})},{key:"_getAnchorElement",value:function(e){if(!e)return null;var t=e.startContainer;return t.nodeType===Node.TEXT_NODE&&(t=t.parentNode),t.closest("a")}},{key:"saveSelection",value:function(){var e=window.getSelection();return e.rangeCount>0&&this.ui.content.contains(e.anchorNode)?($.log("Saving selection range."),e.getRangeAt(0)):($.log("Could not save selection (not in editor)."),null)}},{key:"restoreSelection",value:function(e){if(e){$.log("Restoring selection range."),this.ui.content.focus();var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}else $.log("No selection range to restore, focusing editor."),this.ui.content.focus()}},{key:"setContent",value:function(e){this.ui.content.innerHTML!==e&&(this.ui.content.innerHTML=e,this.ui.code.value=e,this.ui.formInput.value=e)}},{key:"destroy",value:function(){this._initialized&&($.warn("Destroying instance, removing event listeners."),this.contentObserver&&this.contentObserver.disconnect(),this.ui.code.removeEventListener("input",this.handlers.onCodeInput),this.ui.formInput.removeEventListener("input",this.handlers.onFormInput),this.ui.toolbar.removeEventListener("click",this.handlers.onToolbarClick),this.element.__editorInstance=null,this.element=null,this.ui={},this.handlers={},this._initialized=!1,$.log("Editor instance destroyed."))}}]);var e,t}();window.MSSEditor=Q;const W=Q;var Z=new L("App");function ee(){Z.log("Running initMediaSystem..."),document.querySelectorAll('.ms-media-picker-container[data-is-inline="true"]').forEach(function(e){e.__mediaPickerInstance?Z.log("MediaPicker instance already exists for element, skipping.",e):(Z.log("Found new inline MediaPicker to initialize.",e),e.__mediaPickerInstance=new H(e,{isInline:!0}))}),document.querySelectorAll(".ms-media-editor-container").forEach(function(e){Z.log("Processing editor container:",e),e.__editorInstance&&"function"==typeof e.__editorInstance.destroy&&(Z.warn("Forcing destruction of existing editor instance."),e.__editorInstance.destroy()),e.__editorInstance&&"function"==typeof e.__editorInstance.destroy&&(Z.warn("Destroying potentially stale/invalid editor instance for element:",e),e.__editorInstance.destroy(),e.__editorInstance=null),Z.log("Creating new Editor instance for element:",e),e.__editorInstance=new W(e)})}document.addEventListener("DOMContentLoaded",function(){Z.info("Initial DOM Load. Firing initMediaSystem."),ee()}),"undefined"!=typeof Livewire&&(Livewire.hook("morph.updated",function(e){setTimeout(function(){Z.log("Executing initMediaSystem inside setTimeout after morph.updated."),ee()},10)}),Livewire.hook("element.added",function(e){e.matches&&e.matches(".ms-media-editor-container")&&(Z.log("Livewire element.added hook fired for editor container:",e),setTimeout(function(){e.__editorInstance||(Z.log("Initializing new editor from element.added hook.",e),e.__editorInstance=new W(e))},0)),e.querySelectorAll(".ms-media-editor-container").forEach(function(e){e.__editorInstance||(Z.log("Initializing new editor from element.added hook (child).",e),e.__editorInstance=new W(e))})})),window.__MS_MEDIA_PICKER_BOUND__||(Z.log("Binding global media picker modal trigger."),document.addEventListener("click",function(e){var t=e.target.closest("button.ms-media-picker");if(t){Z.log("Media Picker button clicked.",t);var n=t.dataset.targetSelector,i=t.dataset.targetPreview,r=t.dataset.targetType,o=n?document.querySelector(n):null,a=o?o.accept:"";z.open(function(e){if(Z.log("File selection callback triggered with file:",e),n){var t=document.querySelector(n);if(!t)return Z.error('Target element "'.concat(n,'" not found.'));if(i){var o=document.querySelector(i),a=document.querySelector(i+"_preview");o&&(o.src=e.url),a&&(a.style.display="block")}"input"===r?(t.value=e.path,Z.log('Dispatching "input" event for Livewire to update target input.',t),t.dispatchEvent(new Event("input",{bubbles:!0}))):"image"===r?t.src=e.url:"html"===r?t.innerHTML='<img src="'.concat(e.url,'" alt="').concat(e.name,'" style="max-width:100%;">'):Z.warn("Unknown target type for media picker: ".concat(r))}else Z.warn("No target selector defined for media picker button, cannot apply file.")},a,t)}}),window.__MS_MEDIA_PICKER_BOUND__=!0)},909:()=>{}},n={};function i(e){var r=n[e];if(void 0!==r)return r.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,i),o.exports}i.m=t,e=[],i.O=(t,n,r,o)=>{if(!n){var a=1/0;for(u=0;u<e.length;u++){for(var[n,r,o]=e[u],l=!0,c=0;c<n.length;c++)(!1&o||a>=o)&&Object.keys(i.O).every(e=>i.O[e](n[c]))?n.splice(c--,1):(l=!1,o<a&&(a=o));if(l){e.splice(u--,1);var s=r();void 0!==s&&(t=s)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[n,r,o]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={489:0,40:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var r,o,[a,l,c]=n,s=0;if(a.some(t=>0!==e[t])){for(r in l)i.o(l,r)&&(i.m[r]=l[r]);if(c)var u=c(i)}for(t&&t(n);s<a.length;s++)o=a[s],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(u)},n=self.webpackChunkmedia_picker=self.webpackChunkmedia_picker||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),i.O(void 0,[40],()=>i(601));var r=i.O(void 0,[40],()=>i(909));r=i.O(r)})();